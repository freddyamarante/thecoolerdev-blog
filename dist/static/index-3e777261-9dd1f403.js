import{s as z,D,r as o,d as Fe,O as he,j as r,Q as ke,b$ as je,G as fe,au as Ne,R as Be,a2 as $e,c0 as Qe,C as ye,ao as ne,a9 as We,c1 as qe,c2 as Ye,aa as ze,p as B,P as He,c3 as Ue,x as Ve,c4 as Ge,c5 as Ke,c6 as Xe,ag as Je,aE as Ze,B as et,F as W,aC as tt,T as q,z as X,a5 as ge,b7 as nt,H as st,bp as rt,c7 as at,f as ot,bW as it,c8 as ct,c9 as lt,aB as Se,b0 as ut,ca as re,cb as J,aF as dt,bb as be,cc as mt,cd as Ie,ce as Z,aD as Y,b1 as pt,cf as ht,k as ft,bl as ae,cg as yt,ch as gt,bD as St,bE as bt,ci as It,cj as Tt,ck as vt,cl as Lt,cm as Rt,cn as Et,co as _t,cp as Ct,cq as wt}from"./sanity-c1d07973.js";import{useDeskToolSetting as oe}from"./index-0de920bc-169d9daa.js";import{P as Pt}from"./PaneItem-51d63fac-4e965857.js";import"./index-c5ca78a3.js";var ie,ce,le,ue,de;function $(s,e){return e||(e=s.slice(0)),Object.freeze(Object.defineProperties(s,{raw:{value:Object.freeze(e)}}))}const me=100,ee=2e3,Te={by:[{field:"_updatedAt",direction:"desc"}]},xt={};function Ot(s){return It(s).map(e=>({...e.draft||e.published,hasPublished:!!e.published,hasDraft:!!e.draft}))}const At=/\b_type\s*==\s*(['"].*?['"]|\$.*?(?:\s|$))|\B(['"].*?['"]|\$.*?(?:\s|$))\s*==\s*_type\b/;function ve(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=s.match(At);if(!n)return null;const t=(n[1]||n[2]).trim().replace(/^["']|["']$/g,"");if(t[0]==="$"){const a=t.slice(1),d=e[a];return typeof d=="string"?d:null}return t}function Mt(s){return/^_type\s*==\s*['"$]\w+['"]?\s*$/.test(s.trim())}function Dt(s,e){const n=s.by.map(t=>{if(t.mapWith)return t;const a=Ft(e,t.field);return a?jt(a,"datetime")?{...t,mapWith:"dateTime"}:a.jsonType==="string"?{...t,mapWith:"lower"}:t:t});return n.every((t,a)=>t===s.by[a])?s:{...s,by:n}}function Ft(s,e){const n=Ve(e);let t=s;for(const a of n){if(!t)return;if(typeof a=="string"){t=kt(t,a);continue}if(!(Ge(a)||Ke(a))||t.jsonType!=="array")return;const[c,u]=t.of||[];if(u||!c)return;if(!Xe(c)){t=c;continue}const[l,p]=c.to||[];if(p||!l)return;t=l}return t}function kt(s,e){if(!("fields"in s))return;const n=s.fields.find(t=>t.name===e);return n?n.type:void 0}function jt(s,e){let n=s.type;for(;n;){if(n.name===e||!n.type&&n.jsonType===e)return!0;n=n.type}return!1}const Nt=z(D)(ie||(ie=$([`
  position: relative;
`]))),Bt=z(D)(ce||(ce=$([`
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
`]))),$t=[...Array(30).keys()];function Qt(s){const{layout:e}=s;return r(ge,{padding:2,space:1,children:$t.map(n=>r(ye,{padding:2,children:r(Tt,{isPlaceholder:!0,layout:e})},n))})}function Wt(s){const{childItemId:e,error:n,filterIsSimpleTypeConstraint:t,hasMaxItems:a,hasSearchQuery:d,isActive:c,isLazyLoading:u,isLoading:l,items:p,layout:g,loadingVariant:f,onListChange:S,onRetry:R,paneTitle:m,searchInputElement:y,showIcons:E}=s,_=ne(),{collapsed:h}=Je(),{collapsed:b,index:v}=he(),[L,P]=o.useState(!1),F=o.useCallback(()=>{l||u||!L||S()},[u,l,S,L]);o.useEffect(()=>{if(b)return;const i=setTimeout(()=>{P(!0)},0);return()=>{clearTimeout(i)}},[b,p]);const C=o.useCallback((i,x)=>{let{activeIndex:O}=x;const A=Ze(i._id),I=e===A,T=!c&&I,H=c&&I,M=O===p.length-1,U=M&&u,V=M&&a;return B(et,{children:[r(Pt,{icon:E===!1?!1:void 0,id:A,layout:g,marginBottom:1,pressed:T,schemaType:_.get(i._type),selected:H,value:i}),U&&r(W,{align:"center",justify:"center",padding:4,children:r(tt,{muted:!0})}),V&&r(D,{marginY:1,paddingX:3,paddingY:4,children:B(q,{align:"center",muted:!0,size:1,children:["Displaying a maximum of ",ee," documents"]})})]})},[e,c,p.length,g,_,E,a,u]),k=o.useMemo(()=>d?r(W,{align:"center",direction:"column",height:"fill",justify:"center",children:r(X,{width:1,children:r(D,{paddingX:4,paddingY:5,children:r(q,{align:"center",muted:!0,children:"No results found"})})})}):r(W,{align:"center",direction:"column",height:"fill",justify:"center",children:r(X,{width:1,children:r(D,{paddingX:4,paddingY:5,children:r(q,{align:"center",muted:!0,children:t?"No documents of this type":"No matching documents"})})})}),[t,d]),w=o.useMemo(()=>{if(!L)return null;if(n)return r(W,{align:"center",direction:"column",height:"fill",justify:"center",children:r(X,{width:1,children:B(ge,{paddingX:4,paddingY:5,space:4,children:[r(nt,{as:"h3",children:"Could not fetch list items"}),B(q,{as:"p",children:["Error: ",r("code",{children:n.message})]}),R&&r(D,{children:r(fe,{icon:st,onClick:R,text:"Retry",tone:"primary"})})]})})});if(!l&&p.length===0)return k;if(f==="initial"&&l)return r(rt,{ms:300,children:r(Qt,{layout:g})});if(f==="spinner"&&l)return null;const i="".concat(v,"-").concat(b);return r(Nt,{overflow:"hidden",height:"fill",children:r(Bt,{children:r(at,{activeItemDataAttr:"data-hovered",ariaLabel:m,canReceiveFocus:!0,focusRingOffset:-3,inputElement:y,itemHeight:51,items:p,onEndReached:F,onlyShowSelectionWhenActive:!0,overscan:10,padding:2,paddingBottom:1,renderItem:C,wrapAround:!1},i)})})},[b,n,F,v,l,p,g,f,R,C,y,L]);return r(ot,{overflow:h||f==="initial"?"hidden":"auto",children:w})}const Le=o.memo(s=>{let{contentAfter:e,index:n,initialValueTemplates:t=[],menuItemGroups:a=[],menuItems:d=[],setLayout:c,setSortOrder:u,title:l}=s;const{features:p}=Fe(),{collapsed:g,isLast:f}=he(),S=f&&!g?-1:0,R=o.useMemo(()=>({setLayout:m=>{let{layout:y}=m;c(y)},setSortOrder:m=>{u(m)}}),[c,u]);return r(ke,{actions:r(je,{initialValueTemplateItems:t,actionHandlers:R,menuItemGroups:a,menuItems:d}),backButton:p.backButton&&n>0&&r(fe,{as:Ne,"data-as":"a",icon:Be,mode:"bleed"}),contentAfter:e,tabIndex:S,title:l})});Le.displayName="DocumentListPaneHeader";function qt(s){const{client:e,schema:n,sort:t,limit:a,params:d,filter:c,searchQuery:u,staticTypeNames:l}=s,p=t.by,g=t==null?void 0:t.extendedProjection,f=vt(()=>e.listen("*[".concat(c,"]"),d,{events:["welcome","mutation","reconnect"],includeResult:!1,visibility:"query"})).pipe(Z((m,y)=>y===0&&m.type!=="welcome"?J(()=>new Error(m.type==="reconnect"?"Could not establish EventSource connection":'Received unexpected type of first event "'.concat(m.type,'"'))):Y(m)),Lt()),[S,R]=Rt(f,m=>m.type==="welcome");return be(S.pipe(Ie(1)),R.pipe(Et(1e3,Ct,{leading:!0,trailing:!0}))).pipe(_t(()=>(l?Y(l):e.observable.fetch("array::unique(*[".concat(c,"][]._type)"),d)).pipe(Z(y=>{const E=y.flatMap(L=>n.get(L)||[]),_={filter:c,query:u||"",types:E},h={__unstable_extendedProjection:g,comments:["findability-source: ".concat(u?"list-query":"list")],limit:a,params:d,sort:p},{query:b,params:v}=wt(_,h);return e.observable.fetch(b,v)}))))}const Yt=[],pe={error:null,onRetry:void 0,result:null},zt={result:null,error:null};function Ht(s){const{filter:e,params:n,sortOrder:t,searchQuery:a}=s,d=it(ct),c=ne(),[u,l]=o.useState(pe),{onRetry:p,error:g,result:f}=u,S=f==null?void 0:f.documents,R=o.useMemo(()=>S?Ot(S):Yt,[S]),[m,y]=o.useState(!1),[E,_]=o.useState(!1),[h,b]=o.useState(!1),v=o.useMemo(()=>ve(e,n),[e,n]),L=f===null&&!g,P=(S==null?void 0:S.length)===ee,F=o.useCallback(()=>{L||E||h||b(!0)},[L,E,h]),C=o.useCallback(i=>{var x,O;if(i.error){l(i);return}const A=((O=(x=i.result)==null?void 0:x.documents)==null?void 0:O.length)||0;if(!i.error&&(i==null?void 0:i.result)===null&&h){y(!0);return}if(A<me&&A!==0&&!h&&_(!0),(i==null?void 0:i.result)===null){l(T=>({...T.error?i:T}));return}y(!1),l(i)},[h]),k=o.useMemo(()=>{const i=new lt,x=()=>i.next();return qt({client:d,filter:e,limit:h?ee:me,params:n,schema:c,searchQuery:a||"",sort:t||Te,staticTypeNames:v?[v]:void 0}).pipe(Se(I=>({result:{documents:I},error:null})),ut(zt),re(I=>I instanceof ProgressEvent?J(()=>new Error("Request error")):J(()=>I)),re((I,T)=>dt(Y({result:null,error:I}),be(mt(window,"online"),i).pipe(Ie(1),Z(()=>T)))),pt((I,T)=>({...I,...T,onRetry:x})))},[d,e,n,c,a,h,t,v]);o.useEffect(()=>{const i=k.subscribe(C);return()=>{i.unsubscribe()}},[C,k]);const w=o.useCallback(()=>{_(!1),y(!1),l(pe),b(!1)},[]);return o.useEffect(()=>{w()},[w,e,n,t,a]),{error:g,hasMaxItems:P,isLazyLoading:m,isLoading:L,isSearchReady:!g,items:R,onListChange:F,onRetry:p}}const te=[],Ut=$e(le||(le=$([`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`]))),Vt=z(Qe)(ue||(ue=$([`
  animation: `,` 500ms linear infinite;
`])),Ut),Gt=z(ye)(de||(de=$([`
  [data-ui='TextInput'] {
    border-radius: inherit;
  }
`])));function Kt(s){const e=o.useRef(s);return ht(e.current,s)||(e.current=s),e.current}const Xt=s=>{const{menuItems:e,sortOrderRaw:n,layout:t}=s;return e==null?void 0:e.map(a=>{var d,c,u,l;return(d=a.params)!=null&&d.layout?{...a,selected:t===((c=a.params)==null?void 0:c.layout)}:(u=a==null?void 0:a.params)!=null&&u.by?{...a,selected:ft(n==null?void 0:n.by,((l=a==null?void 0:a.params)==null?void 0:l.by)||te)}:{...a,selected:!1}})},sn=o.memo(function(e){const{childItemId:n,index:t,isActive:a,isSelected:d,pane:c,paneKey:u}=e,l=ne(),{name:p}=We(),{defaultLayout:g="default",displayOptions:f,initialValueTemplates:S=te,menuItemGroups:R,menuItems:m,options:y,title:E}=c,{apiVersion:_,defaultOrdering:h=te,filter:b}=y,v=Kt(y.params||xt),L=c.source,P=o.useMemo(()=>ve(b,v),[b,v]),F=(f==null?void 0:f.showIcons)!==!1,[C,k]=oe(P,"layout",g),[w,i]=o.useState(""),[x,O]=o.useState(""),[A,I]=o.useState(null),T=o.useRef(!1),H=o.useMemo(()=>(h==null?void 0:h.length)>0?{by:h}:Te,[h]),[M,U]=oe(P,"sortOrder",H),V=P&&M?Dt(M,l.get(P)):M,Re=qe(V),Ee=Mt(b),{error:_e,hasMaxItems:Ce,isLazyLoading:we,isLoading:j,isSearchReady:Pe,items:G,onListChange:xe,onRetry:Oe}=Ht({apiVersion:_,filter:b,params:v,searchQuery:w==null?void 0:w.trim(),sortOrder:Re}),Ae=o.useMemo(()=>Xt({menuItems:m,sortOrderRaw:M,layout:C}),[C,m,M]),Me=Ye(Q=>Q.pipe(Se(K=>K.target.value),ae(O),yt(K=>K===""?Y(""):gt(300)),ae(i)),[]),N=o.useCallback(()=>{i(""),O("")},[]),De=o.useCallback(Q=>{Q.key==="Escape"&&N()},[N]);o.useEffect(()=>(T.current===!1&&!j&&(T.current=!0),()=>{T.current=!1}),[j]),o.useEffect(()=>{N(),T.current=!1},[u,N]);const se=o.useMemo(()=>j&&G.length===0&&T.current?"spinner":"initial",[j,G.length]);return r(ze,{name:L||p,children:B(He,{currentMaxWidth:350,"data-ui":"DocumentListPane",id:u,maxWidth:640,minWidth:320,selected:d,children:[Ue,r(Le,{contentAfter:r(D,{paddingX:2,paddingBottom:2,children:r(Gt,{radius:4,tone:"transparent",children:r(St,{"aria-label":"Search list",autoComplete:"off",border:!1,clearButton:!!w,disabled:!Pe,fontSize:[2,2,1],icon:se==="spinner"?Vt:bt,onChange:Me,onClear:N,onKeyDown:De,placeholder:"Search list",radius:2,ref:I,spellCheck:!1,value:x})})}),index:t,initialValueTemplates:S,menuItemGroups:R,menuItems:Ae,setLayout:k,setSortOrder:U,title:E}),r(Wt,{childItemId:n,error:_e,filterIsSimpleTypeConstraint:Ee,hasMaxItems:Ce,hasSearchQuery:!!w,isActive:a,isLazyLoading:we,isLoading:j,items:G,layout:C,loadingVariant:se,onListChange:xe,onRetry:Oe,paneTitle:E,searchInputElement:A,showIcons:F},u)]})})});export{sn as default};
